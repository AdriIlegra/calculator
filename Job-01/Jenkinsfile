pipeline {
    agent any

    environment {
        ARTIFACTORY_SERVER_ID = credentials('artifactory_server_id')
        ARTIFACTORY_SERVER_URL = credentials('artifactory_server_url')
        ARTIFACTORY_CREDENTIALS = credentials('artifactory_credentials')
    }
    stages {
        stage('test') {
            steps {
                    sh ("./gradlew test")
            }
        }
        stage('build') {
            steps {
                    sh ("./gradlew clean build")
                }
        }

        stage('publish-artifactory') {
            steps {
                    rtServer (
                        id: env.ARTIFACTORY_SERVER_ID,
                        url: env.ARTIFACTORY_SERVER_URL,
                        credentialsId: env.ARTIFACTORY_CREDENTIALS

                    )
                    rtUpload (
                        serverId: env.ARTIFACTORY_SERVER_ID,
                        spec: '''{
                              "files": [
                                {
                                "pattern": "build/libs/calculator.jar",
                                "target": "tema-01-final/"
                                }
                              ]
                        }'''
                   )
            }
        }
    }

}