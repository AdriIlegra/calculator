pipeline {
    agent any

    environment {
        ARTIFACTORY_SERVER_ID = credentials('artifactory_server_id')
    }
    stages {
        stage('test') {
            steps {
                    sh ("./gradlew test")
            }
        }
        stage('build') {
            steps {
                    sh ("./gradlew clean build")
                }
        }

        stage('publish') {
            steps {
                script {
                    def server = Artifactory.server ARTIFACTORY_SERVER_ID
                    def rtGradle = Artifactory.newGradleBuild()
                    rtGradle.tool = 'gradle'
                    rtGradle.run rootDir: './'
                }
            }
        }
    }
}
