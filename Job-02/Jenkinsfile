pipeline {
    agent any

    environment {
            DOCKERHUB_CREDENTIAL = credentials('docker_hub_credentials')
        ARTIFACTORY_SERVER_ID = credentials('artifactory_server_id')
    }

    stages {
        stage('Initialize Packer') {
            steps {
                sh 'packer init ./Job-02/packer-template.pkr.hcl'
            }
        }

        stage('Build') {
            steps {
                 script {
                                    DOCKERHUB_USERNAME = DOCKERHUB_CREDENTIAL_USUARIO
                                    DOCKERHUB_PASSWORD = DOCKERHUB_CREDENTIAL_SENHA

                                    sh "docker login -u ${DOCKERHUB_USERNAME} -p ${DOCKERHUB_PASSWORD}"

                                    sh 'packer build -var "artifactory_server_id=${ARTIFACTORY_SERVER_ID}" ./Job-02/packer-template.pkr.hcl'
                }
            }
        }
    }
}
