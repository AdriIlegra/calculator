pipeline {
    agent any

    environment {
            DOCKERHUB_CREDENTIAL = credentials('docker_hub_credentials')
        ARTIFACTORY_SERVER_ID = credentials('artifactory_server_id')
    }

    stages {
        stage('Initialize Packer') {
            steps {
                sh 'packer init ./Job-02/packer-template.pkr.hcl'
            }
        }

        stage('Build') {
            steps {
                 script {
                    sh 'packer build -var "dockerhub_credentials=${DOCKERHUB_CREDENTIAL}" ./Job-02/packer-template.pkr.hcl'
                                    sh 'packer build -var "artifactory_server_id=${ARTIFACTORY_SERVER_ID}" ./Job-02/packer-template.pkr.hcl'
                }
            }
        }
    }
}
